# Top-level API version (used to validate schema in the future)
apiVersion: napt/v1

# Friendly project name (appears in logs/reports)
project: "napt - Windows Apps"

defaults:
  # How to compare versions by default.
  # Options: "semver" (semantic versioning, recommended), "lexicographic" (string compare).
  comparator: semver

  updates:
    # Policy for deciding when to stage new builds.
    # - version_only: only when version number increases
    # - version_then_hash: prefer version, but also stage if bits changed (repack)
    # - hash_or_version: stage if version OR hash differs
    # - hash_only: only when hash changes, ignore version strings
    strategy: "version_then_hash"

    # If true, stage repacks where the version is unchanged but the hash differs.
    allow_same_version_hash_change: true

    # Comparator to use when evaluating versions: "semver" or "lexicographic".
    comparator: "semver"

    # Use conditional HTTP requests (ETag / Last-Modified) to avoid redundant downloads.
    use_conditional_requests: true

    # Security settings (future use):
    # - verify_signature: enforce Authenticode signature check
    # - enforce_vendor_cn: restrict signer common name (e.g. "Google LLC")
    verify_signature: false
    enforce_vendor_cn: null

  psadt:
    # PSADT release to use - "latest" or specific version (e.g., "4.1.7")
    release: "latest"
    
    # Cache directory for downloaded PSADT releases
    cache_dir: "cache/psadt"

    # Brand pack replaces default PSADT assets (logo/banner) with custom ones.
    brand_pack:
      # Relative path to folder containing your replacement assets.
      path: brand-packs/napt

      # Mapping rules: local source â†’ template target location.
      mappings:
        - source: "AppIcon.*"        # Any file matching AppIcon.*
          target: "Assets/AppIcon"   # Replaces the template's AppIcon
        - source: "Banner.Classic.*"
          target: "Assets/Banner.Classic"

    # Default app variables injected into Invoke-AppDeployToolkit.ps1
    app_vars:
      AppLang: "EN"                       # Language (EN = English)
      AppRevision: "01"                   # Revision counter for same version
      AppSuccessExitCodes: [0]            # Exit codes treated as success
      AppRebootExitCodes: [1641, 3010]    # Codes that require reboot
      AppProcessesToClose: []             # Processes to close before install
      AppScriptVersion: "1.0.0"           # Script version metadata
      AppScriptAuthor: "napt"             # Author name shown in script header
      RequireAdmin: true                  # Require admin privileges

  build:
    # Output directory for built PSADT packages
    output_dir: "builds"
    
    # Directory naming pattern
    # Supported placeholders: {app_id}, {version}, {vendor}
    naming: "{app_id}/{version}"

  detection:
    # If true, version must match exactly. If false, installed >= required passes.
    # Default: false (allows users to have newer versions without triggering reinstall)
    exact_match: false

    # If true, detection script generation failures abort the build.
    # Default: true (detection scripts are required for Intune deployment)
    fail_on_error: true

    # Maximum log file size in MB before rotation 
    log_rotation_mb: 3

  # Future configuration sections (not yet implemented):
  # - package: Intune package metadata and requirements
  # - assignments: Deployment waves and ring management
