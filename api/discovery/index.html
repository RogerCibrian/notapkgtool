
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Not a Pkg Tool - Windows/Intune packaging with PSADT">
      
      
        <meta name="author" content="Roger Cibrian">
      
      
        <link rel="canonical" href="https://rogercibrian.github.io/notapkgtool/api/discovery/">
      
      
        <link rel="prev" href="../core/">
      
      
        <link rel="next" href="../config/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Discovery - NAPT Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#discovery-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NAPT Documentation" class="md-header__button md-logo" aria-label="NAPT Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NAPT Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Discovery
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/RogerCibrian/notapkgtool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    RogerCibrian/notapkgtool
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NAPT Documentation" class="md-nav__button md-logo" aria-label="NAPT Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NAPT Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/RogerCibrian/notapkgtool" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    RogerCibrian/notapkgtool
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Discovery
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Discovery
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#base-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Base Protocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
    <nav class="md-nav" aria-label="base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base--design-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      Design Philosophy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base--protocol-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Protocol Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      DiscoveryStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscoveryStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version" class="md-nav__link">
    <span class="md-ellipsis">
      discover_version
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discover_version">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      register_strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="register_strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      get_strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-static-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Static Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static" class="md-nav__link">
    <span class="md-ellipsis">
      http_static
    </span>
  </a>
  
    <nav class="md-nav" aria-label="http_static">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--supported-version-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Version Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--configuration-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--workflow-file-first-with-etag-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (File-First with ETag Optimization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--architecture-file-first-vs-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture: File-First vs Version-First
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      HttpStaticStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HttpStaticStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version" class="md-nav__link">
    <span class="md-ellipsis">
      discover_version
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discover_version">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url-regex-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      URL Regex Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex" class="md-nav__link">
    <span class="md-ellipsis">
      url_regex
    </span>
  </a>
  
    <nav class="md-nav" aria-label="url_regex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--supported-version-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Version Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--workflow-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (Version-First)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--architecture-version-first-vs-file-first" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture: Version-First vs File-First
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      UrlRegexStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UrlRegexStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_version_info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_version_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-release-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub Release Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release" class="md-nav__link">
    <span class="md-ellipsis">
      github_release
    </span>
  </a>
  
    <nav class="md-nav" aria-label="github_release">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--supported-version-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Version Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--configuration-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--workflow-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (Version-First)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--rate-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      GithubReleaseStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GithubReleaseStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_version_info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_version_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-json-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP JSON Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json" class="md-nav__link">
    <span class="md-ellipsis">
      http_json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="http_json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--supported-features" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--configuration-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--jsonpath-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      JSONPath Syntax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--workflow-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (Version-First)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      HttpJsonStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HttpJsonStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_version_info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_version_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Build
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../versioning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Versioning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    I/O
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#base-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      Base Protocol
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base" class="md-nav__link">
    <span class="md-ellipsis">
      base
    </span>
  </a>
  
    <nav class="md-nav" aria-label="base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base--design-philosophy" class="md-nav__link">
    <span class="md-ellipsis">
      Design Philosophy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base--protocol-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Protocol Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      DiscoveryStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiscoveryStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version" class="md-nav__link">
    <span class="md-ellipsis">
      discover_version
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discover_version">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.discover_version--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.DiscoveryStrategy.validate_config--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      register_strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="register_strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.register_strategy--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy" class="md-nav__link">
    <span class="md-ellipsis">
      get_strategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.base.get_strategy--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-static-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP Static Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static" class="md-nav__link">
    <span class="md-ellipsis">
      http_static
    </span>
  </a>
  
    <nav class="md-nav" aria-label="http_static">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--supported-version-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Version Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--configuration-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--workflow-file-first-with-etag-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (File-First with ETag Optimization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--architecture-file-first-vs-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture: File-First vs Version-First
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      HttpStaticStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HttpStaticStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version" class="md-nav__link">
    <span class="md-ellipsis">
      discover_version
    </span>
  </a>
  
    <nav class="md-nav" aria-label="discover_version">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#url-regex-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      URL Regex Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex" class="md-nav__link">
    <span class="md-ellipsis">
      url_regex
    </span>
  </a>
  
    <nav class="md-nav" aria-label="url_regex">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--supported-version-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Version Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--workflow-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (Version-First)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--architecture-version-first-vs-file-first" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture: Version-First vs File-First
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      UrlRegexStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UrlRegexStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_version_info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_version_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-release-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      GitHub Release Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release" class="md-nav__link">
    <span class="md-ellipsis">
      github_release
    </span>
  </a>
  
    <nav class="md-nav" aria-label="github_release">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--supported-version-extraction" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Version Extraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--configuration-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--workflow-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (Version-First)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--rate-limits" class="md-nav__link">
    <span class="md-ellipsis">
      Rate Limits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      GithubReleaseStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GithubReleaseStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_version_info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_version_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#http-json-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      HTTP JSON Strategy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json" class="md-nav__link">
    <span class="md-ellipsis">
      http_json
    </span>
  </a>
  
    <nav class="md-nav" aria-label="http_json">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--key-advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Key Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--supported-features" class="md-nav__link">
    <span class="md-ellipsis">
      Supported Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--recipe-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Recipe Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--configuration-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--jsonpath-syntax" class="md-nav__link">
    <span class="md-ellipsis">
      JSONPath Syntax
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--workflow-version-first" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow (Version-First)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json--notes" class="md-nav__link">
    <span class="md-ellipsis">
      Notes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy" class="md-nav__link">
    <span class="md-ellipsis">
      HttpJsonStrategy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HttpJsonStrategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_version_info
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_version_info">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--examples" class="md-nav__link">
    <span class="md-ellipsis">
      Examples
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config" class="md-nav__link">
    <span class="md-ellipsis">
      validate_config
    </span>
  </a>
  
    <nav class="md-nav" aria-label="validate_config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="discovery-module">Discovery Module</h1>
<p>The discovery module implements the strategy pattern for obtaining application installers and extracting version information.</p>
<p>NAPT supports two types of discovery strategies:</p>
<ul>
<li>
<p><strong>Version-First Strategies</strong> (url_regex, github_release, http_json): Discover version without downloading, enabling instant update checks and the ability to skip downloads entirely when versions are unchanged.</p>
</li>
<li>
<p><strong>File-First Strategy</strong> (http_static): Must download file to extract version, uses HTTP ETag conditional requests for optimization.</p>
</li>
</ul>
<h2 id="base-protocol">Base Protocol</h2>


<div class="doc doc-object doc-module">



<h2 id="notapkgtool.discovery.base" class="doc doc-heading">
            <code>notapkgtool.discovery.base</code>


</h2>

    <div class="doc doc-contents first">

        <p>Discovery strategy base protocol and registry for NAPT.</p>


<details class="this-module-defines-the-foundational-components-for-the-discovery-system" open>
  <summary>This module defines the foundational components for the discovery system</summary>
  <ul>
<li>DiscoveryStrategy protocol: Interface that all strategies must implement</li>
<li>Strategy registry: Global dict mapping strategy names to implementations</li>
<li>Registration and lookup functions: register_strategy() and get_strategy()</li>
</ul>
</details>        <p>The discovery system uses a strategy pattern to support multiple ways
of obtaining application installers and their versions:
  - http_static: Direct download from a static URL
  - url_regex: Parse version from URL patterns using regex
  - github_release: Fetch from GitHub releases API
  - http_json: Query JSON API endpoints with JSONPath</p>
<h4 id="notapkgtool.discovery.base--design-philosophy">Design Philosophy</h4>
<ul>
<li>Strategies are Protocol classes (structural subtyping, not inheritance)</li>
<li>Registration happens at module import time (strategies self-register)</li>
<li>Registry is a simple dict (no complex dependency injection needed)</li>
<li>Each strategy is stateless and can be instantiated on-demand</li>
</ul>
<h4 id="notapkgtool.discovery.base--protocol-benefits">Protocol Benefits</h4>
<p>Using typing.Protocol instead of ABC allows:
  - Duck typing: Classes don't need explicit inheritance
  - Better IDE support: Type checkers verify interface compliance
  - Flexibility: Third-party code can add strategies without touching base</p>
<h4 id="notapkgtool.discovery.base--example">Example</h4>
<p>Implementing a custom strategy:</p>
<pre><code>from notapkgtool.discovery.base import register_strategy, DiscoveryStrategy
from pathlib import Path
from typing import Any
from notapkgtool.versioning.keys import DiscoveredVersion

class MyCustomStrategy:
    def discover_version(
        self, app_config: dict[str, Any], output_dir: Path
    ) -&gt; tuple[DiscoveredVersion, Path, str]:
        # Implement your discovery logic here
        ...

# Register it (typically at module import)
register_strategy("my_custom", MyCustomStrategy)

# Now it can be used in recipes:
# source:
#   strategy: my_custom
#   ...
</code></pre>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="notapkgtool.discovery.base.DiscoveryStrategy" class="doc doc-heading">
            <code>DiscoveryStrategy</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Protocol">Protocol</span></code></p>


        <p>Protocol for version discovery strategies.</p>
<p>Each strategy must implement discover_version() which downloads
and extracts version information based on the app config.</p>
<p>Strategies may optionally implement validate_config() to provide
strategy-specific configuration validation without network calls.</p>








              <details class="quote">
                <summary>Source code in <code>notapkgtool/discovery/base.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DiscoveryStrategy</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Protocol for version discovery strategies.</span>

<span class="sd">    Each strategy must implement discover_version() which downloads</span>
<span class="sd">    and extracts version information based on the app config.</span>

<span class="sd">    Strategies may optionally implement validate_config() to provide</span>
<span class="sd">    strategy-specific configuration validation without network calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">discover_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">DiscoveredVersion</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Discover and download an application version.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            The app configuration from the recipe (`config[&quot;apps&quot;][0]`).</span>
<span class="sd">        output_dir : Path</span>
<span class="sd">            Directory to download the installer to.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[DiscoveredVersion, Path, str, dict]</span>
<span class="sd">            - DiscoveredVersion: version info</span>
<span class="sd">            - Path: path to downloaded file</span>
<span class="sd">            - str: SHA-256 hash of the file</span>
<span class="sd">            - dict: HTTP response headers (for ETag/Last-Modified caching)</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError, RuntimeError</span>
<span class="sd">            On discovery or download failures.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate strategy-specific configuration (optional).</span>

<span class="sd">        This method validates the app configuration for strategy-specific</span>
<span class="sd">        requirements without making network calls or downloading files.</span>
<span class="sd">        Useful for quick feedback during recipe development.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            The app configuration from the recipe (`config[&quot;apps&quot;][0]`).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[str]</span>
<span class="sd">            List of error messages. Empty list if configuration is valid.</span>
<span class="sd">            Each error should be a human-readable description of the issue.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        Check required fields:</span>

<span class="sd">            &gt;&gt;&gt; def validate_config(self, app_config):</span>
<span class="sd">            ...     errors = []</span>
<span class="sd">            ...     source = app_config.get(&quot;source&quot;, {})</span>
<span class="sd">            ...     if &quot;url&quot; not in source:</span>
<span class="sd">            ...         errors.append(&quot;Missing required field: source.url&quot;)</span>
<span class="sd">            ...     return errors</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - This method is optional; strategies without it will skip validation</span>
<span class="sd">        - Should NOT make network calls or download files</span>
<span class="sd">        - Should check field presence, types, and format only</span>
<span class="sd">        - Used by &#39;napt validate&#39; command for fast recipe checking</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="o">...</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.base.DiscoveryStrategy.discover_version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">discover_version</span><span class="p">(</span><span class="n">app_config</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Discover and download an application version.</p>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.discover_version--parameters">Parameters</h6>
<p>app_config : dict
    The app configuration from the recipe (<code>config["apps"][0]</code>).
output_dir : Path
    Directory to download the installer to.</p>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.discover_version--returns">Returns</h6>
<p>tuple[DiscoveredVersion, Path, str, dict]
    - DiscoveredVersion: version info
    - Path: path to downloaded file
    - str: SHA-256 hash of the file
    - dict: HTTP response headers (for ETag/Last-Modified caching)</p>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.discover_version--raises">Raises</h6>
<p>ValueError, RuntimeError
    On discovery or download failures.</p>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discover_version</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">DiscoveredVersion</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Discover and download an application version.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        The app configuration from the recipe (`config[&quot;apps&quot;][0]`).</span>
<span class="sd">    output_dir : Path</span>
<span class="sd">        Directory to download the installer to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[DiscoveredVersion, Path, str, dict]</span>
<span class="sd">        - DiscoveredVersion: version info</span>
<span class="sd">        - Path: path to downloaded file</span>
<span class="sd">        - str: SHA-256 hash of the file</span>
<span class="sd">        - dict: HTTP response headers (for ETag/Last-Modified caching)</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError, RuntimeError</span>
<span class="sd">        On discovery or download failures.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.base.DiscoveryStrategy.validate_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_config</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate strategy-specific configuration (optional).</p>
<p>This method validates the app configuration for strategy-specific
requirements without making network calls or downloading files.
Useful for quick feedback during recipe development.</p>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.validate_config--parameters">Parameters</h6>
<p>app_config : dict
    The app configuration from the recipe (<code>config["apps"][0]</code>).</p>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.validate_config--returns">Returns</h6>
<p>list[str]
    List of error messages. Empty list if configuration is valid.
    Each error should be a human-readable description of the issue.</p>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.validate_config--examples">Examples</h6>
<p>Check required fields:</p>
<pre><code>&gt;&gt;&gt; def validate_config(self, app_config):
...     errors = []
...     source = app_config.get("source", {})
...     if "url" not in source:
...         errors.append("Missing required field: source.url")
...     return errors
</code></pre>
<h6 id="notapkgtool.discovery.base.DiscoveryStrategy.validate_config--notes">Notes</h6>
<ul>
<li>This method is optional; strategies without it will skip validation</li>
<li>Should NOT make network calls or download files</li>
<li>Should check field presence, types, and format only</li>
<li>Used by 'napt validate' command for fast recipe checking</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate strategy-specific configuration (optional).</span>

<span class="sd">    This method validates the app configuration for strategy-specific</span>
<span class="sd">    requirements without making network calls or downloading files.</span>
<span class="sd">    Useful for quick feedback during recipe development.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        The app configuration from the recipe (`config[&quot;apps&quot;][0]`).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of error messages. Empty list if configuration is valid.</span>
<span class="sd">        Each error should be a human-readable description of the issue.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Check required fields:</span>

<span class="sd">        &gt;&gt;&gt; def validate_config(self, app_config):</span>
<span class="sd">        ...     errors = []</span>
<span class="sd">        ...     source = app_config.get(&quot;source&quot;, {})</span>
<span class="sd">        ...     if &quot;url&quot; not in source:</span>
<span class="sd">        ...         errors.append(&quot;Missing required field: source.url&quot;)</span>
<span class="sd">        ...     return errors</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - This method is optional; strategies without it will skip validation</span>
<span class="sd">    - Should NOT make network calls or download files</span>
<span class="sd">    - Should check field presence, types, and format only</span>
<span class="sd">    - Used by &#39;napt validate&#39; command for fast recipe checking</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="o">...</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="notapkgtool.discovery.base.register_strategy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_strategy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">strategy_class</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Register a discovery strategy by name in the global registry.</p>
<p>This function should be called when a strategy module is imported,
typically at module level. Registering the same name twice will
overwrite the previous registration (allows monkey-patching for tests).</p>
<h5 id="notapkgtool.discovery.base.register_strategy--parameters">Parameters</h5>
<p>name : str
    Strategy name (e.g., "http_static"). This is the value used in
    recipe YAML files under source.strategy. Names should be lowercase
    with underscores for readability.
strategy_class : type[DiscoveryStrategy]
    The strategy class to register. Must implement the DiscoveryStrategy
    protocol (have a discover_version method with the correct signature).</p>
<h5 id="notapkgtool.discovery.base.register_strategy--examples">Examples</h5>
<p>Register at module import time:</p>
<pre><code># In discovery/my_strategy.py
from .base import register_strategy

class MyStrategy:
    def discover_version(self, app_config, output_dir):
        ...

register_strategy("my_strategy", MyStrategy)
</code></pre>
<h5 id="notapkgtool.discovery.base.register_strategy--notes">Notes</h5>
<ul>
<li>No validation is performed at registration time</li>
<li>Type checkers will verify protocol compliance at static analysis time</li>
<li>Runtime errors occur at strategy instantiation or invocation</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_strategy</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strategy_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">DiscoveryStrategy</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a discovery strategy by name in the global registry.</span>

<span class="sd">    This function should be called when a strategy module is imported,</span>
<span class="sd">    typically at module level. Registering the same name twice will</span>
<span class="sd">    overwrite the previous registration (allows monkey-patching for tests).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Strategy name (e.g., &quot;http_static&quot;). This is the value used in</span>
<span class="sd">        recipe YAML files under source.strategy. Names should be lowercase</span>
<span class="sd">        with underscores for readability.</span>
<span class="sd">    strategy_class : type[DiscoveryStrategy]</span>
<span class="sd">        The strategy class to register. Must implement the DiscoveryStrategy</span>
<span class="sd">        protocol (have a discover_version method with the correct signature).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Register at module import time:</span>

<span class="sd">        # In discovery/my_strategy.py</span>
<span class="sd">        from .base import register_strategy</span>

<span class="sd">        class MyStrategy:</span>
<span class="sd">            def discover_version(self, app_config, output_dir):</span>
<span class="sd">                ...</span>

<span class="sd">        register_strategy(&quot;my_strategy&quot;, MyStrategy)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - No validation is performed at registration time</span>
<span class="sd">    - Type checkers will verify protocol compliance at static analysis time</span>
<span class="sd">    - Runtime errors occur at strategy instantiation or invocation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_STRATEGY_REGISTRY</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">strategy_class</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="notapkgtool.discovery.base.get_strategy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_strategy</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a discovery strategy instance by name from the global registry.</p>
<p>The strategy is instantiated on-demand (strategies are stateless, so
a new instance is created for each call). The strategy module must
have been imported first for registration to occur.</p>
<h5 id="notapkgtool.discovery.base.get_strategy--parameters">Parameters</h5>
<p>name : str
    Strategy name (e.g., "http_static"). Must exactly match a name
    registered via register_strategy(). Case-sensitive.</p>
<h5 id="notapkgtool.discovery.base.get_strategy--returns">Returns</h5>
<p>DiscoveryStrategy
    A new instance of the requested strategy, ready to use.</p>
<h5 id="notapkgtool.discovery.base.get_strategy--raises">Raises</h5>
<p>ValueError
    If the strategy name is not registered. The error message includes
    a list of available strategies for troubleshooting.</p>
<h5 id="notapkgtool.discovery.base.get_strategy--examples">Examples</h5>
<p>Get and use a strategy:</p>
<pre><code>&gt;&gt;&gt; from notapkgtool.discovery import get_strategy
&gt;&gt;&gt; strategy = get_strategy("http_static")
&gt;&gt;&gt; # Use strategy.discover_version(...)
</code></pre>
<p>Handle unknown strategy:</p>
<pre><code>&gt;&gt;&gt; try:
...     strategy = get_strategy("nonexistent")
... except ValueError as e:
...     print(f"Strategy not found: {e}")
</code></pre>
<h5 id="notapkgtool.discovery.base.get_strategy--notes">Notes</h5>
<ul>
<li>Strategies must be registered before they can be retrieved</li>
<li>The http_static strategy is auto-registered when imported</li>
<li>New strategies can be added by creating a module and registering</li>
</ul>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/base.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_strategy</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DiscoveryStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a discovery strategy instance by name from the global registry.</span>

<span class="sd">    The strategy is instantiated on-demand (strategies are stateless, so</span>
<span class="sd">    a new instance is created for each call). The strategy module must</span>
<span class="sd">    have been imported first for registration to occur.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Strategy name (e.g., &quot;http_static&quot;). Must exactly match a name</span>
<span class="sd">        registered via register_strategy(). Case-sensitive.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DiscoveryStrategy</span>
<span class="sd">        A new instance of the requested strategy, ready to use.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the strategy name is not registered. The error message includes</span>
<span class="sd">        a list of available strategies for troubleshooting.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Get and use a strategy:</span>

<span class="sd">        &gt;&gt;&gt; from notapkgtool.discovery import get_strategy</span>
<span class="sd">        &gt;&gt;&gt; strategy = get_strategy(&quot;http_static&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # Use strategy.discover_version(...)</span>

<span class="sd">    Handle unknown strategy:</span>

<span class="sd">        &gt;&gt;&gt; try:</span>
<span class="sd">        ...     strategy = get_strategy(&quot;nonexistent&quot;)</span>
<span class="sd">        ... except ValueError as e:</span>
<span class="sd">        ...     print(f&quot;Strategy not found: {e}&quot;)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - Strategies must be registered before they can be retrieved</span>
<span class="sd">    - The http_static strategy is auto-registered when imported</span>
<span class="sd">    - New strategies can be added by creating a module and registering</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_STRATEGY_REGISTRY</span><span class="p">:</span>
        <span class="n">available</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_STRATEGY_REGISTRY</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unknown discovery strategy: </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">. Available: </span><span class="si">{</span><span class="n">available</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;(none)&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">_STRATEGY_REGISTRY</span><span class="p">[</span><span class="n">name</span><span class="p">]()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="http-static-strategy">HTTP Static Strategy</h2>


<div class="doc doc-object doc-module">



<h2 id="notapkgtool.discovery.http_static" class="doc doc-heading">
            <code>notapkgtool.discovery.http_static</code>


</h2>

    <div class="doc doc-contents first">

        <p>HTTP static URL discovery strategy for NAPT.</p>
<p>This is a FILE-FIRST strategy that downloads an installer from a fixed HTTP(S)
URL and extracts version information from the downloaded file. Uses HTTP ETag
conditional requests to avoid re-downloading unchanged files.</p>
<h4 id="notapkgtool.discovery.http_static--key-advantages">Key Advantages</h4>
<ul>
<li>Works with any fixed URL (version not required in URL)</li>
<li>Extracts accurate version directly from installer metadata</li>
<li>Uses ETag-based conditional requests for efficiency (~500ms vs full download)</li>
<li>Simple and reliable for vendors with stable download URLs</li>
<li>Fallback strategy when version not available via API/URL pattern</li>
</ul>
<h4 id="notapkgtool.discovery.http_static--supported-version-extraction">Supported Version Extraction</h4>
<ul>
<li>msi_product_version_from_file: Extract ProductVersion property from MSI</li>
<li>(Future) exe_file_version: Extract FileVersion from PE headers</li>
<li>(Future) manual_version: Use a version specified in the recipe</li>
</ul>
<h4 id="notapkgtool.discovery.http_static--use-cases">Use Cases</h4>
<ul>
<li>Google Chrome: Fixed enterprise MSI URL, version embedded in MSI</li>
<li>Mozilla Firefox: Fixed enterprise MSI URL, version embedded in MSI</li>
<li>Vendors with stable download URLs and embedded version metadata</li>
<li>When version not available via API, URL pattern, or GitHub tags</li>
</ul>
<h4 id="notapkgtool.discovery.http_static--recipe-configuration">Recipe Configuration</h4>
<p>source:
  strategy: http_static
  url: "https://vendor.com/installer.msi"          # Required: download URL
  version:
    type: msi_product_version_from_file            # Required: extraction method
    file: "installer.msi"                          # Optional: defaults to URL filename</p>
<h4 id="notapkgtool.discovery.http_static--configuration-fields">Configuration Fields</h4>
<p>url : str
    HTTP(S) URL to download the installer from. This is a required field.
    The URL should be stable and point to the latest version.</p>
<p>version.type : str
    Version extraction method. Currently supported: msi_product_version_from_file.
    This is a required field.</p>
<p>version.file : str, optional
    Specific filename to extract version from. Defaults to the downloaded filename
    derived from the URL or Content-Disposition header.</p>
<h4 id="notapkgtool.discovery.http_static--workflow-file-first-with-etag-optimization">Workflow (File-First with ETag Optimization)</h4>
<ol>
<li>Make conditional HTTP request with cached ETag (If-None-Match header)</li>
<li>Server responds with HTTP 304 Not Modified -&gt; use cached file (~500ms)</li>
<li>Server responds with HTTP 200 OK -&gt; download new version</li>
<li>Extract version from downloaded file based on source.version.type</li>
<li>Return DiscoveredVersion, file path, and SHA-256 hash</li>
</ol>
<h4 id="notapkgtool.discovery.http_static--error-handling">Error Handling</h4>
<ul>
<li>ValueError: Missing or invalid configuration fields</li>
<li>RuntimeError: Download failures, version extraction errors</li>
<li>Errors are chained with 'from err' for better debugging</li>
</ul>
<h4 id="notapkgtool.discovery.http_static--architecture-file-first-vs-version-first">Architecture: File-First vs Version-First</h4>
<ul>
<li>http_static (FILE-FIRST): Downloads file first, then extracts version</li>
<li>Method: discover_version() -&gt; tuple with DiscoveredVersion</li>
<li>Uses: HTTP ETag conditional requests for optimization</li>
<li>Pros: Works with any URL, accurate version from installer</li>
<li>Cons: Must download to know version (~500ms even with 304)</li>
<li>
<p>Best for: Fixed URLs with embedded version metadata</p>
</li>
<li>
<p>url_regex, github_release, http_json (VERSION-FIRST): Version before download</p>
</li>
<li>Method: get_version_info() -&gt; VersionInfo</li>
<li>Uses: Version comparison to skip downloads entirely</li>
<li>Pros: Instant or fast checks (regex/API only), can skip downloads</li>
<li>Cons: Requires version available via API/URL pattern</li>
<li>Best for: Version-encoded URLs, APIs, CI/CD with frequent checks</li>
</ul>
<h4 id="notapkgtool.discovery.http_static--example">Example</h4>
<p>In a recipe YAML:</p>
<pre><code>apps:
  - name: "My App"
    id: "my-app"
    source:
      strategy: http_static
      url: "https://example.com/myapp-setup.msi"
      version:
        type: msi_product_version_from_file
</code></pre>
<p>From Python:</p>
<pre><code>from pathlib import Path
from notapkgtool.discovery.http_static import HttpStaticStrategy

strategy = HttpStaticStrategy()
app_config = {
    "source": {
        "url": "https://example.com/app.msi",
        "version": {"type": "msi_product_version_from_file"},
    }
}

# With cache for ETag optimization
cache = {"etag": 'W/"abc123"', "sha256": "..."}
discovered, file_path, sha256, headers = strategy.discover_version(
    app_config, Path("./downloads"), cache=cache
)
print(f"Version {discovered.version} at {file_path}")
</code></pre>
<p>From Python (using core orchestration):</p>
<pre><code>from pathlib import Path
from notapkgtool.core import discover_recipe

# Automatically uses ETag optimization
result = discover_recipe(Path("recipe.yaml"), Path("./downloads"))
print(f"Version {result['version']} at {result['file_path']}")
</code></pre>
<h4 id="notapkgtool.discovery.http_static--notes">Notes</h4>
<ul>
<li>Must download file to extract version (architectural constraint)</li>
<li>ETag optimization reduces bandwidth but still requires network round-trip</li>
<li>Core orchestration automatically provides cached ETag if available</li>
<li>Server must support ETag or Last-Modified headers for optimization</li>
<li>If server doesn't support conditional requests, full download occurs every time</li>
<li>Consider version-first strategies (url_regex, github_release, http_json) for
  better performance when version available via API or URL pattern</li>
</ul>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="notapkgtool.discovery.http_static.HttpStaticStrategy" class="doc doc-heading">
            <code>HttpStaticStrategy</code>


</h3>


    <div class="doc doc-contents ">


        <p>Discovery strategy for static HTTP(S) URLs.</p>


<details class="configuration-example" open>
  <summary>Configuration example</summary>
  <p>source:
  strategy: http_static
  url: "https://example.com/installer.msi"
  version:
    type: msi_product_version_from_file
    file: "installer.msi"</p>
</details>







              <details class="quote">
                <summary>Source code in <code>notapkgtool/discovery/http_static.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HttpStaticStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Discovery strategy for static HTTP(S) URLs.</span>

<span class="sd">    Configuration example:</span>
<span class="sd">        source:</span>
<span class="sd">          strategy: http_static</span>
<span class="sd">          url: &quot;https://example.com/installer.msi&quot;</span>
<span class="sd">          version:</span>
<span class="sd">            type: msi_product_version_from_file</span>
<span class="sd">            file: &quot;installer.msi&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">discover_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">DiscoveredVersion</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Download from static URL and extract version from the file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            App configuration containing source.url and source.version.</span>
<span class="sd">        output_dir : Path</span>
<span class="sd">            Directory to save the downloaded file.</span>
<span class="sd">        cache : dict, optional</span>
<span class="sd">            Cached state with etag, last_modified, file_path, and sha256</span>
<span class="sd">            for conditional requests. If provided and file is unchanged</span>
<span class="sd">            (HTTP 304), the cached file is returned.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[DiscoveredVersion, Path, str, dict]</span>
<span class="sd">            Version info, file path, SHA-256 hash, and HTTP response headers.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If required config fields are missing or invalid.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If download or version extraction fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;http_static strategy requires &#39;source.url&#39; in config&quot;</span><span class="p">)</span>

        <span class="n">version_config</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">version_type</span> <span class="o">=</span> <span class="n">version_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;http_static strategy requires &#39;source.version.type&#39; in config&quot;</span>
            <span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: http_static&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Source URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version extraction: </span><span class="si">{</span><span class="n">version_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract ETag/Last-Modified from cache if available</span>
        <span class="n">etag</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;etag&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">last_modified</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_modified&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">etag</span><span class="p">:</span>
            <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Using cached ETag: </span><span class="si">{</span><span class="n">etag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_modified</span><span class="p">:</span>
            <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Using cached Last-Modified: </span><span class="si">{</span><span class="n">last_modified</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Download the file (with conditional request if cache available)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">file_path</span><span class="p">,</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">output_dir</span><span class="p">,</span>
                <span class="n">etag</span><span class="o">=</span><span class="n">etag</span><span class="p">,</span>
                <span class="n">last_modified</span><span class="o">=</span><span class="n">last_modified</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">NotModifiedError</span><span class="p">:</span>
            <span class="c1"># File unchanged (HTTP 304), use cached version</span>
            <span class="c1"># Use convention-based path: derive filename from URL</span>
            <span class="n">print_verbose</span><span class="p">(</span>
                <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;File not modified (HTTP 304), using cached version&quot;</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cache</span> <span class="ow">or</span> <span class="s2">&quot;sha256&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="s2">&quot;Cache indicates file not modified, but missing SHA-256. &quot;</span>
                    <span class="s2">&quot;Try running with --stateless to force re-download.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

            <span class="c1"># Derive file path from URL (convention-based, schema v2)</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
            <span class="n">cached_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">filename</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Cached file </span><span class="si">{</span><span class="n">cached_file</span><span class="si">}</span><span class="s2"> not found. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;File may have been deleted. Try running with --stateless.&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

            <span class="c1"># Extract version from cached file</span>
            <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="s2">&quot;msi_product_version_from_file&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">discovered</span> <span class="o">=</span> <span class="n">version_from_msi_product_version</span><span class="p">(</span>
                        <span class="n">cached_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to extract MSI ProductVersion from cached file </span><span class="si">{</span><span class="n">cached_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unsupported version type: </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Supported: msi_product_version_from_file&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

            <span class="c1"># Return cached info with preserved headers (prevents overwriting ETag)</span>
            <span class="c1"># When 304, no new headers received, so return cached values to preserve them</span>
            <span class="n">preserved_headers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;etag&quot;</span><span class="p">):</span>
                <span class="n">preserved_headers</span><span class="p">[</span><span class="s2">&quot;ETag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;etag&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_modified&quot;</span><span class="p">):</span>
                <span class="n">preserved_headers</span><span class="p">[</span><span class="s2">&quot;Last-Modified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;last_modified&quot;</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">discovered</span><span class="p">,</span> <span class="n">cached_file</span><span class="p">,</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sha256&quot;</span><span class="p">],</span> <span class="n">preserved_headers</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to download </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="c1"># File was downloaded (not cached), extract version from it</span>
        <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="s2">&quot;msi_product_version_from_file&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">discovered</span> <span class="o">=</span> <span class="n">version_from_msi_product_version</span><span class="p">(</span>
                    <span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to extract MSI ProductVersion from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unsupported version type: </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Supported: msi_product_version_from_file&quot;</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">discovered</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">headers</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate http_static strategy configuration.</span>

<span class="sd">        Checks for required fields and correct types without making network calls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            The app configuration from the recipe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[str]</span>
<span class="sd">            List of error messages (empty if valid).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check required fields</span>
        <span class="k">if</span> <span class="s2">&quot;url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.url&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url cannot be empty&quot;</span><span class="p">)</span>

        <span class="c1"># Check version configuration</span>
        <span class="k">if</span> <span class="s2">&quot;version&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.version&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version must be a dictionary&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version_config</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>

            <span class="c1"># Check version.type</span>
            <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">version_config</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.version.type&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version.type must be a string&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">version_type</span> <span class="o">=</span> <span class="n">version_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
                <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;msi_product_version_from_file&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">version_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unsupported source.version.type: </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Supported: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">discover_version</span><span class="p">(</span><span class="n">app_config</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Download from static URL and extract version from the file.</p>
<h6 id="notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--parameters">Parameters</h6>
<p>app_config : dict
    App configuration containing source.url and source.version.
output_dir : Path
    Directory to save the downloaded file.
cache : dict, optional
    Cached state with etag, last_modified, file_path, and sha256
    for conditional requests. If provided and file is unchanged
    (HTTP 304), the cached file is returned.</p>
<h6 id="notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--returns">Returns</h6>
<p>tuple[DiscoveredVersion, Path, str, dict]
    Version info, file path, SHA-256 hash, and HTTP response headers.</p>
<h6 id="notapkgtool.discovery.http_static.HttpStaticStrategy.discover_version--raises">Raises</h6>
<p>ValueError
    If required config fields are missing or invalid.
RuntimeError
    If download or version extraction fails.</p>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/http_static.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discover_version</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">DiscoveredVersion</span><span class="p">,</span> <span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download from static URL and extract version from the file.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        App configuration containing source.url and source.version.</span>
<span class="sd">    output_dir : Path</span>
<span class="sd">        Directory to save the downloaded file.</span>
<span class="sd">    cache : dict, optional</span>
<span class="sd">        Cached state with etag, last_modified, file_path, and sha256</span>
<span class="sd">        for conditional requests. If provided and file is unchanged</span>
<span class="sd">        (HTTP 304), the cached file is returned.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[DiscoveredVersion, Path, str, dict]</span>
<span class="sd">        Version info, file path, SHA-256 hash, and HTTP response headers.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If required config fields are missing or invalid.</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        If download or version extraction fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;http_static strategy requires &#39;source.url&#39; in config&quot;</span><span class="p">)</span>

    <span class="n">version_config</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">version_type</span> <span class="o">=</span> <span class="n">version_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">version_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;http_static strategy requires &#39;source.version.type&#39; in config&quot;</span>
        <span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: http_static&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Source URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version extraction: </span><span class="si">{</span><span class="n">version_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Extract ETag/Last-Modified from cache if available</span>
    <span class="n">etag</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;etag&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">last_modified</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_modified&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">cache</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">etag</span><span class="p">:</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Using cached ETag: </span><span class="si">{</span><span class="n">etag</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">last_modified</span><span class="p">:</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Using cached Last-Modified: </span><span class="si">{</span><span class="n">last_modified</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Download the file (with conditional request if cache available)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_path</span><span class="p">,</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">output_dir</span><span class="p">,</span>
            <span class="n">etag</span><span class="o">=</span><span class="n">etag</span><span class="p">,</span>
            <span class="n">last_modified</span><span class="o">=</span><span class="n">last_modified</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">debug</span><span class="o">=</span><span class="n">debug</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">NotModifiedError</span><span class="p">:</span>
        <span class="c1"># File unchanged (HTTP 304), use cached version</span>
        <span class="c1"># Use convention-based path: derive filename from URL</span>
        <span class="n">print_verbose</span><span class="p">(</span>
            <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;File not modified (HTTP 304), using cached version&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cache</span> <span class="ow">or</span> <span class="s2">&quot;sha256&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;Cache indicates file not modified, but missing SHA-256. &quot;</span>
                <span class="s2">&quot;Try running with --stateless to force re-download.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

        <span class="c1"># Derive file path from URL (convention-based, schema v2)</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="n">cached_file</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="n">filename</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cached file </span><span class="si">{</span><span class="n">cached_file</span><span class="si">}</span><span class="s2"> not found. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;File may have been deleted. Try running with --stateless.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

        <span class="c1"># Extract version from cached file</span>
        <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="s2">&quot;msi_product_version_from_file&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">discovered</span> <span class="o">=</span> <span class="n">version_from_msi_product_version</span><span class="p">(</span>
                    <span class="n">cached_file</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to extract MSI ProductVersion from cached file </span><span class="si">{</span><span class="n">cached_file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Unsupported version type: </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Supported: msi_product_version_from_file&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="kc">None</span>

        <span class="c1"># Return cached info with preserved headers (prevents overwriting ETag)</span>
        <span class="c1"># When 304, no new headers received, so return cached values to preserve them</span>
        <span class="n">preserved_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;etag&quot;</span><span class="p">):</span>
            <span class="n">preserved_headers</span><span class="p">[</span><span class="s2">&quot;ETag&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;etag&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_modified&quot;</span><span class="p">):</span>
            <span class="n">preserved_headers</span><span class="p">[</span><span class="s2">&quot;Last-Modified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;last_modified&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">discovered</span><span class="p">,</span> <span class="n">cached_file</span><span class="p">,</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;sha256&quot;</span><span class="p">],</span> <span class="n">preserved_headers</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to download </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="c1"># File was downloaded (not cached), extract version from it</span>
    <span class="k">if</span> <span class="n">version_type</span> <span class="o">==</span> <span class="s2">&quot;msi_product_version_from_file&quot;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">discovered</span> <span class="o">=</span> <span class="n">version_from_msi_product_version</span><span class="p">(</span>
                <span class="n">file_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to extract MSI ProductVersion from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Unsupported version type: </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Supported: msi_product_version_from_file&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">discovered</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">sha256</span><span class="p">,</span> <span class="n">headers</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_config</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate http_static strategy configuration.</p>
<p>Checks for required fields and correct types without making network calls.</p>
<h6 id="notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config--parameters">Parameters</h6>
<p>app_config : dict
    The app configuration from the recipe.</p>
<h6 id="notapkgtool.discovery.http_static.HttpStaticStrategy.validate_config--returns">Returns</h6>
<p>list[str]
    List of error messages (empty if valid).</p>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/http_static.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate http_static strategy configuration.</span>

<span class="sd">    Checks for required fields and correct types without making network calls.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        The app configuration from the recipe.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of error messages (empty if valid).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Check required fields</span>
    <span class="k">if</span> <span class="s2">&quot;url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.url&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url cannot be empty&quot;</span><span class="p">)</span>

    <span class="c1"># Check version configuration</span>
    <span class="k">if</span> <span class="s2">&quot;version&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.version&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version must be a dictionary&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">version_config</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>

        <span class="c1"># Check version.type</span>
        <span class="k">if</span> <span class="s2">&quot;type&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">version_config</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.version.type&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">version_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version.type must be a string&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version_type</span> <span class="o">=</span> <span class="n">version_config</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
            <span class="n">supported_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;msi_product_version_from_file&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">version_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_types</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Unsupported source.version.type: </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Supported: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supported_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="url-regex-strategy">URL Regex Strategy</h2>


<div class="doc doc-object doc-module">



<h2 id="notapkgtool.discovery.url_regex" class="doc doc-heading">
            <code>notapkgtool.discovery.url_regex</code>


</h2>

    <div class="doc doc-contents first">

        <p>URL regex discovery strategy for NAPT.</p>
<p>This is a VERSION-FIRST strategy that extracts version information directly
from the download URL using regular expressions, WITHOUT downloading. This
enables instant version checks and efficient caching.</p>
<h4 id="notapkgtool.discovery.url_regex--key-advantages">Key Advantages</h4>
<ul>
<li>Instant version discovery (regex only, zero network calls)</li>
<li>Can skip downloads entirely when version unchanged</li>
<li>Works with any file type (MSI, EXE, DMG, etc.)</li>
<li>No file parsing overhead</li>
<li>Ideal for CI/CD with scheduled checks</li>
</ul>
<h4 id="notapkgtool.discovery.url_regex--supported-version-extraction">Supported Version Extraction</h4>
<ul>
<li>regex_in_url: Extract version from URL using a regex pattern</li>
<li>Supports named capture groups: (?P<version>...)</li>
<li>Falls back to full match if no named group</li>
</ul>
<h4 id="notapkgtool.discovery.url_regex--use-cases">Use Cases</h4>
<ul>
<li>Vendors with version-encoded download URLs
  Example: https://vendor.com/app-v1.2.3-installer.msi</li>
<li>API endpoints that return version-specific download links
  Example: https://api.vendor.com/download/2024.10.28/setup.exe</li>
<li>URLs with predictable version patterns in the path</li>
<li>CI/CD pipelines with frequent version checks</li>
</ul>
<h4 id="notapkgtool.discovery.url_regex--recipe-configuration">Recipe Configuration</h4>
<p>source:
  strategy: url_regex
  url: "https://vendor.com/downloads/app-v1.2.3-setup.msi"
  version:
    type: regex_in_url
    pattern: "app-v(?P<version>[0-9.]+)-setup"</p>
<p>The pattern supports full Python regex syntax. Use a named capture group
(?P<version>) to extract only the version portion, or let the entire match
be used as the version.</p>
<h4 id="notapkgtool.discovery.url_regex--workflow-version-first">Workflow (Version-First)</h4>
<ol>
<li>Extract version from URL using regex pattern (instant)</li>
<li>Create VersionInfo with version and download URL</li>
<li>Core orchestration compares version to cache</li>
<li>If match and file exists -&gt; skip download entirely</li>
<li>If changed or missing -&gt; download from URL</li>
</ol>
<h4 id="notapkgtool.discovery.url_regex--error-handling">Error Handling</h4>
<ul>
<li>ValueError: Missing or invalid configuration fields, pattern doesn't match</li>
<li>re.error: Invalid regex patterns (propagates from regex compilation)</li>
</ul>
<h4 id="notapkgtool.discovery.url_regex--architecture-version-first-vs-file-first">Architecture: Version-First vs File-First</h4>
<ul>
<li>url_regex (VERSION-FIRST): Extracts version from URL before download</li>
<li>Method: get_version_info() -&gt; VersionInfo</li>
<li>Pros: Instant checks, can skip downloads when unchanged</li>
<li>Cons: Requires predictable URL patterns</li>
<li>
<p>Best for: Version-encoded URLs, frequent update checks</p>
</li>
<li>
<p>http_static (FILE-FIRST): Downloads file first, then extracts version</p>
</li>
<li>Method: discover_version() -&gt; tuple with DiscoveredVersion</li>
<li>Pros: Works with any URL, accurate version from installer</li>
<li>Cons: Must download to know version</li>
<li>Best for: Fixed URLs with embedded version metadata</li>
</ul>
<h4 id="notapkgtool.discovery.url_regex--example">Example</h4>
<p>In a recipe YAML:</p>
<pre><code>apps:
  - name: "My App"
    id: "my-app"
    source:
      strategy: url_regex
      url: "https://example.com/myapp-v2.1.0-setup.msi"
      version:
        type: regex_in_url
        pattern: "myapp-v(?P&lt;version&gt;[0-9.]+)-setup"
</code></pre>
<p>From Python (version-first approach):</p>
<pre><code>from notapkgtool.discovery.url_regex import UrlRegexStrategy
from notapkgtool.io import download_file

strategy = UrlRegexStrategy()
app_config = {
    "source": {
        "url": "https://example.com/app-v1.2.3.msi",
        "version": {
            "type": "regex_in_url",
            "pattern": r"app-v(?P&lt;version&gt;[0-9.]+)\.msi",
        },
    }
}

# Get version WITHOUT downloading
version_info = strategy.get_version_info(app_config)
print(f"Latest version: {version_info.version}")

# Download only if needed
if need_to_download:
    file_path, sha256, headers = download_file(
        version_info.download_url, Path("./downloads")
    )
    print(f"Downloaded to {file_path}")
</code></pre>
<p>From Python (using core orchestration):</p>
<pre><code>from pathlib import Path
from notapkgtool.core import discover_recipe

# Automatically uses version-first optimization
result = discover_recipe(Path("recipe.yaml"), Path("./downloads"))
print(f"Version {result['version']} at {result['file_path']}")
</code></pre>
<h4 id="notapkgtool.discovery.url_regex--notes">Notes</h4>
<ul>
<li>Version extraction happens WITHOUT download (instant)</li>
<li>Core orchestration automatically skips download if version unchanged</li>
<li>The URL pattern must be stable and predictable</li>
<li>Pattern matching is case-sensitive by default (use (?i) for case-insensitive)</li>
<li>Consider http_static if URLs don't contain version information</li>
</ul>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="notapkgtool.discovery.url_regex.UrlRegexStrategy" class="doc doc-heading">
            <code>UrlRegexStrategy</code>


</h3>


    <div class="doc doc-contents ">


        <p>Discovery strategy for extracting version from URL patterns.</p>


<details class="configuration-example" open>
  <summary>Configuration example</summary>
  <p>source:
  strategy: url_regex
  url: "https://vendor.com/app-v1.2.3-installer.msi"
  version:
    type: regex_in_url
    pattern: "app-v(?P<version>[0-9.]+)-installer"</p>
</details>







              <details class="quote">
                <summary>Source code in <code>notapkgtool/discovery/url_regex.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UrlRegexStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Discovery strategy for extracting version from URL patterns.</span>

<span class="sd">    Configuration example:</span>
<span class="sd">        source:</span>
<span class="sd">          strategy: url_regex</span>
<span class="sd">          url: &quot;https://vendor.com/app-v1.2.3-installer.msi&quot;</span>
<span class="sd">          version:</span>
<span class="sd">            type: regex_in_url</span>
<span class="sd">            pattern: &quot;app-v(?P&lt;version&gt;[0-9.]+)-installer&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract version from URL without downloading (version-first path).</span>

<span class="sd">        This method enables fast version checking by extracting the version</span>
<span class="sd">        directly from the URL pattern. If the version matches cached state,</span>
<span class="sd">        the download can be skipped entirely.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            App configuration containing source.url, source.version.type,</span>
<span class="sd">            and source.version.pattern.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            If True, print verbose logging messages. Default is False.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            If True, print debug logging messages. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        VersionInfo</span>
<span class="sd">            Version info with version string, download URL, and source name.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If required config fields are missing, invalid, or if the regex</span>
<span class="sd">            pattern doesn&#39;t match the URL.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; strategy = UrlRegexStrategy()</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;source&quot;: {</span>
<span class="sd">        ...         &quot;url&quot;: &quot;https://vendor.com/app-v1.0.0.msi&quot;,</span>
<span class="sd">        ...         &quot;version&quot;: {</span>
<span class="sd">        ...             &quot;type&quot;: &quot;regex_in_url&quot;,</span>
<span class="sd">        ...             &quot;pattern&quot;: &quot;app-v(?P&lt;version&gt;[0-9.]+)\\\\.msi&quot;</span>
<span class="sd">        ...         }</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; version_info = strategy.get_version_info(config)</span>
<span class="sd">        &gt;&gt;&gt; version_info.version</span>
<span class="sd">        &#39;1.0.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

        <span class="c1"># Validate configuration</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;url_regex strategy requires &#39;source.url&#39; in config&quot;</span><span class="p">)</span>

        <span class="n">version_config</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">version_type</span> <span class="o">=</span> <span class="n">version_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;url_regex strategy requires &#39;source.version.type&#39; in config&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">version_type</span> <span class="o">!=</span> <span class="s2">&quot;regex_in_url&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;url_regex strategy requires version.type=&#39;regex_in_url&#39;, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">pattern</span> <span class="o">=</span> <span class="n">version_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;url_regex strategy requires &#39;source.version.pattern&#39; in config&quot;</span>
            <span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: url_regex (version-first)&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Source URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Regex pattern: </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract version from URL (no download needed!)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">discovered</span> <span class="o">=</span> <span class="n">version_from_regex_in_url</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to extract version from URL using regex: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Discovered version: </span><span class="si">{</span><span class="n">discovered</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">VersionInfo</span><span class="p">(</span>
            <span class="n">version</span><span class="o">=</span><span class="n">discovered</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
            <span class="n">download_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;url_regex&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate url_regex strategy configuration.</span>

<span class="sd">        Checks for required fields and correct types without making network calls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            The app configuration from the recipe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[str]</span>
<span class="sd">            List of error messages (empty if valid).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check required fields</span>
        <span class="k">if</span> <span class="s2">&quot;url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.url&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.pattern&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.pattern must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.pattern cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate regex pattern syntax</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;(?P&lt;version&gt;&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;source.pattern must contain named group (?P&lt;version&gt;...)&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Try to compile the regex to check syntax</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid regex pattern: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_version_info</span><span class="p">(</span><span class="n">app_config</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Extract version from URL without downloading (version-first path).</p>
<p>This method enables fast version checking by extracting the version
directly from the URL pattern. If the version matches cached state,
the download can be skipped entirely.</p>
<h6 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--parameters">Parameters</h6>
<p>app_config : dict
    App configuration containing source.url, source.version.type,
    and source.version.pattern.
verbose : bool, optional
    If True, print verbose logging messages. Default is False.
debug : bool, optional
    If True, print debug logging messages. Default is False.</p>
<h6 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--returns">Returns</h6>
<p>VersionInfo
    Version info with version string, download URL, and source name.</p>
<h6 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--raises">Raises</h6>
<p>ValueError
    If required config fields are missing, invalid, or if the regex
    pattern doesn't match the URL.</p>
<h6 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.get_version_info--examples">Examples</h6>
<blockquote>
<blockquote>
<blockquote>
<p>strategy = UrlRegexStrategy()
config = {
...     "source": {
...         "url": "https://vendor.com/app-v1.0.0.msi",
...         "version": {
...             "type": "regex_in_url",
...             "pattern": "app-v(?P<version>[0-9.]+)\.msi"
...         }
...     }
... }
version_info = strategy.get_version_info(config)
version_info.version
'1.0.0'</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/url_regex.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract version from URL without downloading (version-first path).</span>

<span class="sd">    This method enables fast version checking by extracting the version</span>
<span class="sd">    directly from the URL pattern. If the version matches cached state,</span>
<span class="sd">    the download can be skipped entirely.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        App configuration containing source.url, source.version.type,</span>
<span class="sd">        and source.version.pattern.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        If True, print verbose logging messages. Default is False.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, print debug logging messages. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VersionInfo</span>
<span class="sd">        Version info with version string, download URL, and source name.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If required config fields are missing, invalid, or if the regex</span>
<span class="sd">        pattern doesn&#39;t match the URL.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; strategy = UrlRegexStrategy()</span>
<span class="sd">    &gt;&gt;&gt; config = {</span>
<span class="sd">    ...     &quot;source&quot;: {</span>
<span class="sd">    ...         &quot;url&quot;: &quot;https://vendor.com/app-v1.0.0.msi&quot;,</span>
<span class="sd">    ...         &quot;version&quot;: {</span>
<span class="sd">    ...             &quot;type&quot;: &quot;regex_in_url&quot;,</span>
<span class="sd">    ...             &quot;pattern&quot;: &quot;app-v(?P&lt;version&gt;[0-9.]+)\\\\.msi&quot;</span>
<span class="sd">    ...         }</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; version_info = strategy.get_version_info(config)</span>
<span class="sd">    &gt;&gt;&gt; version_info.version</span>
<span class="sd">    &#39;1.0.0&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

    <span class="c1"># Validate configuration</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;url_regex strategy requires &#39;source.url&#39; in config&quot;</span><span class="p">)</span>

    <span class="n">version_config</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">version_type</span> <span class="o">=</span> <span class="n">version_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">version_type</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;url_regex strategy requires &#39;source.version.type&#39; in config&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">version_type</span> <span class="o">!=</span> <span class="s2">&quot;regex_in_url&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;url_regex strategy requires version.type=&#39;regex_in_url&#39;, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="n">version_type</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">pattern</span> <span class="o">=</span> <span class="n">version_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pattern</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;url_regex strategy requires &#39;source.version.pattern&#39; in config&quot;</span>
        <span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: url_regex (version-first)&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Source URL: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Regex pattern: </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Extract version from URL (no download needed!)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">discovered</span> <span class="o">=</span> <span class="n">version_from_regex_in_url</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="n">debug</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to extract version from URL using regex: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Discovered version: </span><span class="si">{</span><span class="n">discovered</span><span class="o">.</span><span class="n">version</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">VersionInfo</span><span class="p">(</span>
        <span class="n">version</span><span class="o">=</span><span class="n">discovered</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
        <span class="n">download_url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s2">&quot;url_regex&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_config</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate url_regex strategy configuration.</p>
<p>Checks for required fields and correct types without making network calls.</p>
<h6 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config--parameters">Parameters</h6>
<p>app_config : dict
    The app configuration from the recipe.</p>
<h6 id="notapkgtool.discovery.url_regex.UrlRegexStrategy.validate_config--returns">Returns</h6>
<p>list[str]
    List of error messages (empty if valid).</p>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/url_regex.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate url_regex strategy configuration.</span>

<span class="sd">    Checks for required fields and correct types without making network calls.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        The app configuration from the recipe.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of error messages (empty if valid).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Check required fields</span>
    <span class="k">if</span> <span class="s2">&quot;url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.url&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.url cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.pattern&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.pattern must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.pattern cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Validate regex pattern syntax</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;pattern&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;(?P&lt;version&gt;&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;source.pattern must contain named group (?P&lt;version&gt;...)&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Try to compile the regex to check syntax</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid regex pattern: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="github-release-strategy">GitHub Release Strategy</h2>


<div class="doc doc-object doc-module">



<h2 id="notapkgtool.discovery.github_release" class="doc doc-heading">
            <code>notapkgtool.discovery.github_release</code>


</h2>

    <div class="doc doc-contents first">

        <p>GitHub releases discovery strategy for NAPT.</p>
<p>This is a VERSION-FIRST strategy that queries the GitHub API to get version
and download URL WITHOUT downloading the installer. This enables fast version
checks and efficient caching.</p>
<h4 id="notapkgtool.discovery.github_release--key-advantages">Key Advantages</h4>
<ul>
<li>Fast version discovery (GitHub API call ~100ms)</li>
<li>Can skip downloads entirely when version unchanged</li>
<li>Direct access to latest releases via stable GitHub API</li>
<li>Version extraction from Git tags (semantic versioning friendly)</li>
<li>Asset pattern matching for multi-platform releases</li>
<li>Optional authentication for higher rate limits</li>
<li>No web scraping required</li>
<li>Ideal for CI/CD with scheduled checks</li>
</ul>
<h4 id="notapkgtool.discovery.github_release--supported-version-extraction">Supported Version Extraction</h4>
<ul>
<li>Tag-based: Extract version from release tag names</li>
<li>Supports named capture groups: (?P<version>...)</li>
<li>Default pattern strips "v" prefix: v1.2.3  1.2.3</li>
<li>Falls back to full tag if no pattern match</li>
</ul>
<h4 id="notapkgtool.discovery.github_release--use-cases">Use Cases</h4>
<ul>
<li>Open-source projects (Git, VS Code, Node.js, etc.)</li>
<li>Projects with GitHub releases (Firefox, Chrome alternatives)</li>
<li>Vendors who publish installers as release assets</li>
<li>Projects with semantic versioned tags</li>
<li>CI/CD pipelines with frequent version checks</li>
</ul>
<h4 id="notapkgtool.discovery.github_release--recipe-configuration">Recipe Configuration</h4>
<p>source:
  strategy: github_release
  repo: "git-for-windows/git"                    # Required: owner/repo
  asset_pattern: "Git-.*-64-bit.exe$"          # Optional: regex for asset
  version_pattern: "v?([0-9.]+)"                 # Optional: version extraction
  prerelease: false                              # Optional: include prereleases
  token: "${GITHUB_TOKEN}"                       # Optional: auth token</p>
<h4 id="notapkgtool.discovery.github_release--configuration-fields">Configuration Fields</h4>
<p>repo : str
    GitHub repository in "owner/name" format (e.g., "git-for-windows/git").
    This is the only required field.</p>


<details class="asset_pattern-" open>
  <summary>str, optional</summary>
  <p>Regular expression to match asset filename. If multiple assets match,
the first match is used. If omitted, the first asset is selected.
Example: ".*-x64.msi$" matches assets ending with "-x64.msi"</p>
</details>

<details class="version_pattern-" open>
  <summary>str, optional</summary>
  <p>Regular expression to extract version from the release tag name.
Use a named capture group (?P<version>...) or the entire match.
Default: "v?([0-9.]+)" strips optional "v" prefix.
Example: "release-([0-9.]+)" for tags like "release-1.2.3"</p>
</details>

<details class="prerelease-" open>
  <summary>bool, optional</summary>
  <p>If True, include pre-release versions. If False (default), only
stable releases are considered. Uses GitHub's prerelease flag.</p>
</details>

<details class="token-" open>
  <summary>str, optional</summary>
  <p>GitHub personal access token for authentication. Increases rate limit
from 60 to 5000 requests per hour. Can use environment variable
substitution: "${GITHUB_TOKEN}".
Note: No special permissions needed for public repositories.</p>
</details>        <h4 id="notapkgtool.discovery.github_release--workflow-version-first">Workflow (Version-First)</h4>
<ol>
<li>Call GitHub API: GET /repos/{owner}/{repo}/releases/latest (~100ms)</li>
<li>Extract version from release tag using version_pattern</li>
<li>Find matching asset using asset_pattern (or first asset)</li>
<li>Create VersionInfo with version and download URL</li>
<li>Core orchestration compares version to cache</li>
<li>If match and file exists -&gt; skip download entirely</li>
<li>If changed or missing -&gt; download from URL</li>
</ol>
<h4 id="notapkgtool.discovery.github_release--error-handling">Error Handling</h4>
<ul>
<li>ValueError: Missing or invalid configuration fields</li>
<li>RuntimeError: API failures, no releases, no matching assets</li>
<li>Errors are chained with 'from err' for better debugging</li>
</ul>
<h4 id="notapkgtool.discovery.github_release--rate-limits">Rate Limits</h4>
<ul>
<li>Unauthenticated: 60 requests/hour per IP</li>
<li>Authenticated: 5000 requests/hour per token</li>
<li>Tip: Use a token for production use or frequent checks</li>
</ul>
<h4 id="notapkgtool.discovery.github_release--example">Example</h4>
<p>In a recipe YAML:</p>
<pre><code>apps:
  - name: "Git for Windows"
    id: "git"
    source:
      strategy: github_release
      repo: "git-for-windows/git"
      asset_pattern: "Git-.*-64-bit\.exe$"
      version:
        type: tag  # Version comes from tag, not file
</code></pre>
<p>From Python (version-first approach):</p>
<pre><code>from notapkgtool.discovery.github_release import GithubReleaseStrategy
from notapkgtool.io import download_file

strategy = GithubReleaseStrategy()
app_config = {
    "source": {
        "repo": "git-for-windows/git",
        "asset_pattern": ".*-64-bit\.exe$",
    }
}

# Get version WITHOUT downloading
version_info = strategy.get_version_info(app_config)
print(f"Latest version: {version_info.version}")

# Download only if needed
if need_to_download:
    file_path, sha256, headers = download_file(
        version_info.download_url, Path("./downloads")
    )
    print(f"Downloaded to {file_path}")
</code></pre>
<p>From Python (using core orchestration):</p>
<pre><code>from pathlib import Path
from notapkgtool.core import discover_recipe

# Automatically uses version-first optimization
result = discover_recipe(Path("recipe.yaml"), Path("./downloads"))
print(f"Version {result['version']} at {result['file_path']}")
</code></pre>
<h4 id="notapkgtool.discovery.github_release--notes">Notes</h4>
<ul>
<li>Version discovery via API only (no download required)</li>
<li>Core orchestration automatically skips download if version unchanged</li>
<li>The GitHub API is stable and well-documented</li>
<li>Releases are fetched in order (latest first)</li>
<li>Asset matching is case-sensitive by default (use (?i) for case-insensitive)</li>
<li>Consider http_static if you need a direct download URL instead</li>
</ul>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="notapkgtool.discovery.github_release.GithubReleaseStrategy" class="doc doc-heading">
            <code>GithubReleaseStrategy</code>


</h3>


    <div class="doc doc-contents ">


        <p>Discovery strategy for GitHub releases.</p>


<details class="configuration-example" open>
  <summary>Configuration example</summary>
  <p>source:
  strategy: github_release
  repo: "owner/repository"
  asset_pattern: ".*.msi$"
  version_pattern: "v?([0-9.]+)"
  prerelease: false
  token: "${GITHUB_TOKEN}"</p>
</details>







              <details class="quote">
                <summary>Source code in <code>notapkgtool/discovery/github_release.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GithubReleaseStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Discovery strategy for GitHub releases.</span>

<span class="sd">    Configuration example:</span>
<span class="sd">        source:</span>
<span class="sd">          strategy: github_release</span>
<span class="sd">          repo: &quot;owner/repository&quot;</span>
<span class="sd">          asset_pattern: &quot;.*\\.msi$&quot;</span>
<span class="sd">          version_pattern: &quot;v?([0-9.]+)&quot;</span>
<span class="sd">          prerelease: false</span>
<span class="sd">          token: &quot;${GITHUB_TOKEN}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch latest release from GitHub API without downloading (version-first path).</span>

<span class="sd">        This method queries the GitHub API for the latest release and extracts</span>
<span class="sd">        the version from the tag name and the download URL from matching assets.</span>
<span class="sd">        If the version matches cached state, the download can be skipped entirely.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            App configuration containing source.repo and optional fields.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            If True, print verbose logging messages. Default is False.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            If True, print debug logging messages. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        VersionInfo</span>
<span class="sd">            Version info with version string, download URL, and source name.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If required config fields are missing, invalid, or if no matching</span>
<span class="sd">            assets are found.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If API call fails or release has no assets.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; strategy = GithubReleaseStrategy()</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;source&quot;: {</span>
<span class="sd">        ...         &quot;repo&quot;: &quot;owner/repo&quot;,</span>
<span class="sd">        ...         &quot;asset_pattern&quot;: &quot;.*\\.msi$&quot;</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; version_info = strategy.get_version_info(config)</span>
<span class="sd">        &gt;&gt;&gt; version_info.version</span>
<span class="sd">        &#39;1.0.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

        <span class="c1"># Validate configuration</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repo&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">repo</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;github_release strategy requires &#39;source.repo&#39; in config&quot;</span><span class="p">)</span>

        <span class="c1"># Validate repo format</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repo</span> <span class="ow">or</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid repo format: </span><span class="si">{</span><span class="n">repo</span><span class="si">!r}</span><span class="s2">. Expected &#39;owner/repository&#39;&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Optional configuration</span>
        <span class="n">asset_pattern</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">)</span>
        <span class="n">version_pattern</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version_pattern&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;v?([0-9.]+)&quot;</span><span class="p">)</span>
        <span class="n">prerelease</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prerelease&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span>

        <span class="c1"># Expand environment variables in token (e.g., ${GITHUB_TOKEN})</span>
        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;${&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">):</span>
                <span class="n">env_var</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_var</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
                    <span class="n">print_verbose</span><span class="p">(</span>
                        <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Warning: Environment variable </span><span class="si">{</span><span class="n">env_var</span><span class="si">}</span><span class="s2"> not set&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: github_release (version-first)&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Repository: </span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version pattern: </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">asset_pattern</span><span class="p">:</span>
            <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Asset pattern: </span><span class="si">{</span><span class="n">asset_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prerelease</span><span class="p">:</span>
            <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Including pre-releases&quot;</span><span class="p">)</span>

        <span class="c1"># Fetch latest release from GitHub API</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.github.com/repos/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/releases/latest&quot;</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github+json&quot;</span><span class="p">,</span>
            <span class="s2">&quot;X-GitHub-Api-Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-11-28&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Add authentication if token provided</span>
        <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Using authenticated API request&quot;</span><span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Fetching release from: </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Repository </span><span class="si">{</span><span class="n">repo</span><span class="si">!r}</span><span class="s2"> not found or has no releases&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;GitHub API rate limit exceeded. Consider using a token. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;GitHub API request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch GitHub release: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="n">release_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># Check if this is a prerelease and we don&#39;t want those</span>
        <span class="k">if</span> <span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prerelease&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">prerelease</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Latest release is a pre-release and prerelease=false. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Tag: </span><span class="si">{</span><span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tag_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Extract version from tag name</span>
        <span class="n">tag_name</span> <span class="o">=</span> <span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Release has no tag_name field&quot;</span><span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Release tag: </span><span class="si">{</span><span class="n">tag_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">version_pattern</span><span class="p">)</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Version pattern </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">!r}</span><span class="s2"> did not match tag </span><span class="si">{</span><span class="n">tag_name</span><span class="si">!r}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Try to get named capture group &#39;version&#39; first, else use group 1, else full match</span>
            <span class="k">if</span> <span class="s2">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">groupindex</span><span class="p">:</span>
                <span class="n">version_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">pattern</span><span class="o">.</span><span class="n">groups</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">version_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">version_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid version_pattern regex: </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to extract version from tag </span><span class="si">{</span><span class="n">tag_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;using pattern </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracted version: </span><span class="si">{</span><span class="n">version_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Find matching asset</span>
        <span class="n">assets</span> <span class="o">=</span> <span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">assets</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Release </span><span class="si">{</span><span class="n">tag_name</span><span class="si">}</span><span class="s2"> has no assets. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Check if assets were uploaded to the release.&quot;</span>
            <span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Release has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span><span class="si">}</span><span class="s2"> asset(s)&quot;</span><span class="p">)</span>

        <span class="c1"># Match asset by pattern or take first</span>
        <span class="n">matched_asset</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">asset_pattern</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">asset_pattern</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Invalid asset_pattern regex: </span><span class="si">{</span><span class="n">asset_pattern</span><span class="si">!r}</span><span class="s2">&quot;</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

            <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
                <span class="n">asset_name</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asset_name</span><span class="p">):</span>
                    <span class="n">matched_asset</span> <span class="o">=</span> <span class="n">asset</span>
                    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Matched asset: </span><span class="si">{</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_asset</span><span class="p">:</span>
                <span class="n">available</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;(unnamed)&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">]</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No assets matched pattern </span><span class="si">{</span><span class="n">asset_pattern</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Available assets: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">matched_asset</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">print_verbose</span><span class="p">(</span>
                <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;No pattern specified, using first asset: </span><span class="si">{</span><span class="n">matched_asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Get download URL</span>
        <span class="n">download_url</span> <span class="o">=</span> <span class="n">matched_asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;browser_download_url&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">download_url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asset </span><span class="si">{</span><span class="n">matched_asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no download URL&quot;</span><span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Download URL: </span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">VersionInfo</span><span class="p">(</span>
            <span class="n">version</span><span class="o">=</span><span class="n">version_str</span><span class="p">,</span>
            <span class="n">download_url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;github_release&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate github_release strategy configuration.</span>

<span class="sd">        Checks for required fields and correct types without making network calls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            The app configuration from the recipe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[str]</span>
<span class="sd">            List of error messages (empty if valid).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check required fields</span>
        <span class="k">if</span> <span class="s2">&quot;repo&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.repo&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.repo must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.repo cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate repo format</span>
            <span class="n">repo</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;source.repo must be in format &#39;owner/repo&#39; (e.g., &#39;git/git&#39;)&quot;</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;asset_pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.asset_pattern&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.asset_pattern must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.asset_pattern cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate regex pattern syntax</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">]</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid asset_pattern regex: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Optional fields validation</span>
        <span class="k">if</span> <span class="s2">&quot;version_pattern&quot;</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_pattern&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version_pattern must be a string&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_pattern&quot;</span><span class="p">]</span>
                <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                    <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid version_pattern regex: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_version_info</span><span class="p">(</span><span class="n">app_config</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Fetch latest release from GitHub API without downloading (version-first path).</p>
<p>This method queries the GitHub API for the latest release and extracts
the version from the tag name and the download URL from matching assets.
If the version matches cached state, the download can be skipped entirely.</p>
<h6 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--parameters">Parameters</h6>
<p>app_config : dict
    App configuration containing source.repo and optional fields.
verbose : bool, optional
    If True, print verbose logging messages. Default is False.
debug : bool, optional
    If True, print debug logging messages. Default is False.</p>
<h6 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--returns">Returns</h6>
<p>VersionInfo
    Version info with version string, download URL, and source name.</p>
<h6 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--raises">Raises</h6>
<p>ValueError
    If required config fields are missing, invalid, or if no matching
    assets are found.
RuntimeError
    If API call fails or release has no assets.</p>
<h6 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.get_version_info--examples">Examples</h6>
<blockquote>
<blockquote>
<blockquote>
<p>strategy = GithubReleaseStrategy()
config = {
...     "source": {
...         "repo": "owner/repo",
...         "asset_pattern": ".*.msi$"
...     }
... }
version_info = strategy.get_version_info(config)
version_info.version
'1.0.0'</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/github_release.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch latest release from GitHub API without downloading (version-first path).</span>

<span class="sd">    This method queries the GitHub API for the latest release and extracts</span>
<span class="sd">    the version from the tag name and the download URL from matching assets.</span>
<span class="sd">    If the version matches cached state, the download can be skipped entirely.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        App configuration containing source.repo and optional fields.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        If True, print verbose logging messages. Default is False.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, print debug logging messages. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VersionInfo</span>
<span class="sd">        Version info with version string, download URL, and source name.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If required config fields are missing, invalid, or if no matching</span>
<span class="sd">        assets are found.</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        If API call fails or release has no assets.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; strategy = GithubReleaseStrategy()</span>
<span class="sd">    &gt;&gt;&gt; config = {</span>
<span class="sd">    ...     &quot;source&quot;: {</span>
<span class="sd">    ...         &quot;repo&quot;: &quot;owner/repo&quot;,</span>
<span class="sd">    ...         &quot;asset_pattern&quot;: &quot;.*\\.msi$&quot;</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; version_info = strategy.get_version_info(config)</span>
<span class="sd">    &gt;&gt;&gt; version_info.version</span>
<span class="sd">    &#39;1.0.0&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

    <span class="c1"># Validate configuration</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">repo</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;repo&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">repo</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;github_release strategy requires &#39;source.repo&#39; in config&quot;</span><span class="p">)</span>

    <span class="c1"># Validate repo format</span>
    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">repo</span> <span class="ow">or</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid repo format: </span><span class="si">{</span><span class="n">repo</span><span class="si">!r}</span><span class="s2">. Expected &#39;owner/repository&#39;&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Optional configuration</span>
    <span class="n">asset_pattern</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">)</span>
    <span class="n">version_pattern</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version_pattern&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;v?([0-9.]+)&quot;</span><span class="p">)</span>
    <span class="n">prerelease</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prerelease&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span>

    <span class="c1"># Expand environment variables in token (e.g., ${GITHUB_TOKEN})</span>
    <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">token</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;${&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">token</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">):</span>
            <span class="n">env_var</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_var</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span>
                <span class="n">print_verbose</span><span class="p">(</span>
                    <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: Environment variable </span><span class="si">{</span><span class="n">env_var</span><span class="si">}</span><span class="s2"> not set&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: github_release (version-first)&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Repository: </span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version pattern: </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">asset_pattern</span><span class="p">:</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Asset pattern: </span><span class="si">{</span><span class="n">asset_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prerelease</span><span class="p">:</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Including pre-releases&quot;</span><span class="p">)</span>

    <span class="c1"># Fetch latest release from GitHub API</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.github.com/repos/</span><span class="si">{</span><span class="n">repo</span><span class="si">}</span><span class="s2">/releases/latest&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;application/vnd.github+json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;X-GitHub-Api-Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-11-28&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Add authentication if token provided</span>
    <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;token </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Using authenticated API request&quot;</span><span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Fetching release from: </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">404</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Repository </span><span class="si">{</span><span class="n">repo</span><span class="si">!r}</span><span class="s2"> not found or has no releases&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GitHub API rate limit exceeded. Consider using a token. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Status: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;GitHub API request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch GitHub release: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="n">release_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="c1"># Check if this is a prerelease and we don&#39;t want those</span>
    <span class="k">if</span> <span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prerelease&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">prerelease</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Latest release is a pre-release and prerelease=false. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Tag: </span><span class="si">{</span><span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tag_name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Extract version from tag name</span>
    <span class="n">tag_name</span> <span class="o">=</span> <span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tag_name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">tag_name</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Release has no tag_name field&quot;</span><span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Release tag: </span><span class="si">{</span><span class="n">tag_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">version_pattern</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">tag_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Version pattern </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">!r}</span><span class="s2"> did not match tag </span><span class="si">{</span><span class="n">tag_name</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Try to get named capture group &#39;version&#39; first, else use group 1, else full match</span>
        <span class="k">if</span> <span class="s2">&quot;version&quot;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">groupindex</span><span class="p">:</span>
            <span class="n">version_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">pattern</span><span class="o">.</span><span class="n">groups</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">version_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version_str</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid version_pattern regex: </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to extract version from tag </span><span class="si">{</span><span class="n">tag_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;using pattern </span><span class="si">{</span><span class="n">version_pattern</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracted version: </span><span class="si">{</span><span class="n">version_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Find matching asset</span>
    <span class="n">assets</span> <span class="o">=</span> <span class="n">release_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;assets&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">assets</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Release </span><span class="si">{</span><span class="n">tag_name</span><span class="si">}</span><span class="s2"> has no assets. &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Check if assets were uploaded to the release.&quot;</span>
        <span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Release has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">assets</span><span class="p">)</span><span class="si">}</span><span class="s2"> asset(s)&quot;</span><span class="p">)</span>

    <span class="c1"># Match asset by pattern or take first</span>
    <span class="n">matched_asset</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">asset_pattern</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">asset_pattern</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid asset_pattern regex: </span><span class="si">{</span><span class="n">asset_pattern</span><span class="si">!r}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="k">for</span> <span class="n">asset</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">:</span>
            <span class="n">asset_name</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">asset_name</span><span class="p">):</span>
                <span class="n">matched_asset</span> <span class="o">=</span> <span class="n">asset</span>
                <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Matched asset: </span><span class="si">{</span><span class="n">asset_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_asset</span><span class="p">:</span>
            <span class="n">available</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;(unnamed)&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">assets</span><span class="p">]</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No assets matched pattern </span><span class="si">{</span><span class="n">asset_pattern</span><span class="si">!r}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Available assets: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">available</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">matched_asset</span> <span class="o">=</span> <span class="n">assets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">print_verbose</span><span class="p">(</span>
            <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">&quot;No pattern specified, using first asset: </span><span class="si">{</span><span class="n">matched_asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Get download URL</span>
    <span class="n">download_url</span> <span class="o">=</span> <span class="n">matched_asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;browser_download_url&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">download_url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Asset </span><span class="si">{</span><span class="n">matched_asset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no download URL&quot;</span><span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Download URL: </span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">VersionInfo</span><span class="p">(</span>
        <span class="n">version</span><span class="o">=</span><span class="n">version_str</span><span class="p">,</span>
        <span class="n">download_url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s2">&quot;github_release&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_config</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate github_release strategy configuration.</p>
<p>Checks for required fields and correct types without making network calls.</p>
<h6 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config--parameters">Parameters</h6>
<p>app_config : dict
    The app configuration from the recipe.</p>
<h6 id="notapkgtool.discovery.github_release.GithubReleaseStrategy.validate_config--returns">Returns</h6>
<p>list[str]
    List of error messages (empty if valid).</p>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/github_release.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate github_release strategy configuration.</span>

<span class="sd">    Checks for required fields and correct types without making network calls.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        The app configuration from the recipe.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of error messages (empty if valid).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Check required fields</span>
    <span class="k">if</span> <span class="s2">&quot;repo&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.repo&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.repo must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.repo cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Validate repo format</span>
        <span class="n">repo</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;repo&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">repo</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;source.repo must be in format &#39;owner/repo&#39; (e.g., &#39;git/git&#39;)&quot;</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;asset_pattern&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.asset_pattern&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.asset_pattern must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.asset_pattern cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Validate regex pattern syntax</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;asset_pattern&quot;</span><span class="p">]</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid asset_pattern regex: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Optional fields validation</span>
    <span class="k">if</span> <span class="s2">&quot;version_pattern&quot;</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_pattern&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version_pattern must be a string&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_pattern&quot;</span><span class="p">]</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid version_pattern regex: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="http-json-strategy">HTTP JSON Strategy</h2>


<div class="doc doc-object doc-module">



<h2 id="notapkgtool.discovery.http_json" class="doc doc-heading">
            <code>notapkgtool.discovery.http_json</code>


</h2>

    <div class="doc doc-contents first">

        <p>HTTP JSON API discovery strategy for NAPT.</p>
<p>This is a VERSION-FIRST strategy that queries JSON API endpoints to get version
and download URL WITHOUT downloading the installer. This enables fast version
checks and efficient caching.</p>
<h4 id="notapkgtool.discovery.http_json--key-advantages">Key Advantages</h4>
<ul>
<li>Fast version discovery (API call ~100ms)</li>
<li>Can skip downloads entirely when version unchanged</li>
<li>Direct API access for version and download URL</li>
<li>Support for complex JSON structures with JSONPath</li>
<li>Custom headers for authentication</li>
<li>Support for GET and POST requests</li>
<li>No file parsing required</li>
<li>Ideal for CI/CD with scheduled checks</li>
</ul>
<h4 id="notapkgtool.discovery.http_json--supported-features">Supported Features</h4>
<ul>
<li>JSONPath navigation for nested structures</li>
<li>Array indexing and filtering</li>
<li>Custom HTTP headers (Authorization, etc.)</li>
<li>POST requests with JSON body</li>
<li>Environment variable expansion in values</li>
</ul>
<h4 id="notapkgtool.discovery.http_json--use-cases">Use Cases</h4>
<ul>
<li>Vendors with JSON APIs (Microsoft, Mozilla, etc.)</li>
<li>Cloud services with version endpoints</li>
<li>CDNs that provide metadata APIs</li>
<li>Applications with update check APIs</li>
<li>APIs requiring authentication or custom headers</li>
<li>CI/CD pipelines with frequent version checks</li>
</ul>
<h4 id="notapkgtool.discovery.http_json--recipe-configuration">Recipe Configuration</h4>
<p>source:
  strategy: http_json
  api_url: "https://vendor.com/api/latest"
  version_path: "version"                      # JSONPath to version
  download_url_path: "download_url"            # JSONPath to URL
  method: "GET"                                # Optional: GET or POST
  headers:                                     # Optional: custom headers
    Authorization: "Bearer ${API_TOKEN}"
    Accept: "application/json"
  body:                                        # Optional: POST body
    platform: "windows"
    arch: "x64"
  timeout: 30                                  # Optional: timeout in seconds</p>
<h4 id="notapkgtool.discovery.http_json--configuration-fields">Configuration Fields</h4>
<p>api_url : str
    API endpoint URL that returns JSON with version and download information.
    This is a required field.</p>


<details class="version_path-" open>
  <summary>str</summary>
  <p>JSONPath expression to extract version from the API response.
Examples: "version", "release.version", "[0].version"
This is a required field.</p>
</details>

<details class="download_url_path-" open>
  <summary>str</summary>
  <p>JSONPath expression to extract download URL from the API response.
Examples: "download_url", "assets[0].url", "platforms.windows.x64"
This is a required field.</p>
</details>

<details class="method-" open>
  <summary>str, optional</summary>
  <p>HTTP method to use. Either "GET" or "POST". Default is "GET".</p>
</details>

<details class="headers-" open>
  <summary>dict, optional</summary>
  <p>Custom HTTP headers to send with the request. Useful for authentication
or setting Accept headers. Values support environment variable expansion.
Example: {"Authorization": "Bearer ${API_TOKEN}"}</p>
</details>

<details class="body-" open>
  <summary>dict, optional</summary>
  <p>Request body for POST requests. Sent as JSON. Only used when method="POST".
Example: {"platform": "windows", "arch": "x64"}</p>
</details>

<details class="timeout-" open>
  <summary>int, optional</summary>
  <p>Request timeout in seconds. Default is 30.</p>
</details>        <h4 id="notapkgtool.discovery.http_json--jsonpath-syntax">JSONPath Syntax</h4>
<p>Simple paths:
  - "version"  {"version": "1.2.3"}
  - "release.version"  {"release": {"version": "1.2.3"}}</p>


<details class="array-indexing" open>
  <summary>Array indexing</summary>
  <ul>
<li>"[0].version"  [{"version": "1.2.3"}]</li>
<li>"releases[-1].version"  Last item in array</li>
</ul>
</details>

<details class="nested-paths" open>
  <summary>Nested paths</summary>
  <ul>
<li>"data.latest.download.url"</li>
<li>"response.assets[0].browser_download_url"</li>
</ul>
</details>        <h4 id="notapkgtool.discovery.http_json--workflow-version-first">Workflow (Version-First)</h4>
<ol>
<li>Build HTTP request (GET or POST) with headers</li>
<li>Call API endpoint and get JSON response (~100ms)</li>
<li>Parse JSON and extract version using JSONPath</li>
<li>Extract download URL using JSONPath</li>
<li>Create VersionInfo with version and download URL</li>
<li>Core orchestration compares version to cache</li>
<li>If match and file exists -&gt; skip download entirely</li>
<li>If changed or missing -&gt; download from URL</li>
</ol>
<h4 id="notapkgtool.discovery.http_json--error-handling">Error Handling</h4>
<ul>
<li>ValueError: Missing or invalid configuration, invalid JSONPath, path not found</li>
<li>RuntimeError: API failures, invalid JSON response</li>
<li>Errors are chained with 'from err' for better debugging</li>
</ul>
<h4 id="notapkgtool.discovery.http_json--example">Example</h4>
<p>In a recipe YAML (simple API):</p>
<pre><code>apps:
  - name: "My App"
    id: "my-app"
    source:
      strategy: http_json
      api_url: "https://api.vendor.com/latest"
      version_path: "version"
      download_url_path: "download_url"
</code></pre>
<p>In a recipe YAML (nested structure):</p>
<pre><code>apps:
  - name: "My App"
    id: "my-app"
    source:
      strategy: http_json
      api_url: "https://api.vendor.com/releases"
      version_path: "stable.version"
      download_url_path: "stable.platforms.windows.x64"
      headers:
        Authorization: "Bearer ${API_TOKEN}"
</code></pre>
<p>From Python (version-first approach):</p>
<pre><code>from notapkgtool.discovery.http_json import HttpJsonStrategy
from notapkgtool.io import download_file

strategy = HttpJsonStrategy()
app_config = {
    "source": {
        "api_url": "https://api.vendor.com/latest",
        "version_path": "version",
        "download_url_path": "download_url",
    }
}

# Get version WITHOUT downloading
version_info = strategy.get_version_info(app_config)
print(f"Latest version: {version_info.version}")

# Download only if needed
if need_to_download:
    file_path, sha256, headers = download_file(
        version_info.download_url, Path("./downloads")
    )
    print(f"Downloaded to {file_path}")
</code></pre>
<p>From Python (using core orchestration):</p>
<pre><code>from pathlib import Path
from notapkgtool.core import discover_recipe

# Automatically uses version-first optimization
result = discover_recipe(Path("recipe.yaml"), Path("./downloads"))
print(f"Version {result['version']} at {result['file_path']}")
</code></pre>
<h4 id="notapkgtool.discovery.http_json--notes">Notes</h4>
<ul>
<li>Version discovery via API only (no download required)</li>
<li>Core orchestration automatically skips download if version unchanged</li>
<li>JSONPath uses jsonpath-ng library for robust parsing</li>
<li>Environment variable expansion works in headers and other string values</li>
<li>POST body is sent as JSON (Content-Type: application/json)</li>
<li>Timeout defaults to 30 seconds to prevent hanging on slow APIs</li>
</ul>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="notapkgtool.discovery.http_json.HttpJsonStrategy" class="doc doc-heading">
            <code>HttpJsonStrategy</code>


</h3>


    <div class="doc doc-contents ">


        <p>Discovery strategy for JSON API endpoints.</p>


<details class="configuration-example" open>
  <summary>Configuration example</summary>
  <p>source:
  strategy: http_json
  api_url: "https://api.vendor.com/latest"
  version_path: "version"
  download_url_path: "download_url"
  method: "GET"
  headers:
    Authorization: "Bearer ${API_TOKEN}"</p>
</details>







              <details class="quote">
                <summary>Source code in <code>notapkgtool/discovery/http_json.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HttpJsonStrategy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Discovery strategy for JSON API endpoints.</span>

<span class="sd">    Configuration example:</span>
<span class="sd">        source:</span>
<span class="sd">          strategy: http_json</span>
<span class="sd">          api_url: &quot;https://api.vendor.com/latest&quot;</span>
<span class="sd">          version_path: &quot;version&quot;</span>
<span class="sd">          download_url_path: &quot;download_url&quot;</span>
<span class="sd">          method: &quot;GET&quot;</span>
<span class="sd">          headers:</span>
<span class="sd">            Authorization: &quot;Bearer ${API_TOKEN}&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionInfo</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query JSON API for version and download URL without downloading (version-first path).</span>

<span class="sd">        This method calls a JSON API, extracts version and download URL using</span>
<span class="sd">        JSONPath expressions. If the version matches cached state, the download</span>
<span class="sd">        can be skipped entirely.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            App configuration containing source.api_url, source.version_path,</span>
<span class="sd">            and source.download_url_path.</span>
<span class="sd">        verbose : bool, optional</span>
<span class="sd">            If True, print verbose logging messages. Default is False.</span>
<span class="sd">        debug : bool, optional</span>
<span class="sd">            If True, print debug logging messages. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        VersionInfo</span>
<span class="sd">            Version info with version string, download URL, and source name.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        ValueError</span>
<span class="sd">            If required config fields are missing, invalid, or if JSONPath</span>
<span class="sd">            expressions don&#39;t match anything in the response.</span>
<span class="sd">        RuntimeError</span>
<span class="sd">            If API call fails (chained with &#39;from err&#39;).</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; strategy = HttpJsonStrategy()</span>
<span class="sd">        &gt;&gt;&gt; config = {</span>
<span class="sd">        ...     &quot;source&quot;: {</span>
<span class="sd">        ...         &quot;api_url&quot;: &quot;https://api.vendor.com/latest&quot;,</span>
<span class="sd">        ...         &quot;version_path&quot;: &quot;version&quot;,</span>
<span class="sd">        ...         &quot;download_url_path&quot;: &quot;download_url&quot;</span>
<span class="sd">        ...     }</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; version_info = strategy.get_version_info(config)</span>
<span class="sd">        &gt;&gt;&gt; version_info.version</span>
<span class="sd">        &#39;1.0.0&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

        <span class="c1"># Validate configuration</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">api_url</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;http_json strategy requires &#39;source.api_url&#39; in config&quot;</span><span class="p">)</span>

        <span class="n">version_path</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version_path&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;http_json strategy requires &#39;source.version_path&#39; in config&quot;</span>
            <span class="p">)</span>

        <span class="n">download_url_path</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">download_url_path</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;http_json strategy requires &#39;source.download_url_path&#39; in config&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Optional configuration</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid method: </span><span class="si">{</span><span class="n">method</span><span class="si">!r}</span><span class="s2">. Must be &#39;GET&#39; or &#39;POST&#39;&quot;</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: http_json (version-first)&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;API URL: </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version path: </span><span class="si">{</span><span class="n">version_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Download URL path: </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Expand environment variables in headers</span>
        <span class="n">expanded_headers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;${&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">env_var</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">env_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_var</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">env_value</span><span class="p">:</span>
                    <span class="n">print_verbose</span><span class="p">(</span>
                        <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Warning: Environment variable </span><span class="si">{</span><span class="n">env_var</span><span class="si">}</span><span class="s2"> not set&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">expanded_headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expanded_headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Make API request</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Calling API: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">expanded_headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># POST</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                    <span class="n">api_url</span><span class="p">,</span>
                    <span class="n">headers</span><span class="o">=</span><span class="n">expanded_headers</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;API request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to call API: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;API response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> OK&quot;</span><span class="p">)</span>

        <span class="c1"># Parse JSON response</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Invalid JSON response from API. Response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="n">print_verbose</span><span class="p">(</span>
                <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;JSON response: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Extract version using JSONPath</span>
        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracting version from path: </span><span class="si">{</span><span class="n">version_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">version_expr</span> <span class="o">=</span> <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">version_path</span><span class="p">)</span>
            <span class="n">version_matches</span> <span class="o">=</span> <span class="n">version_expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">version_matches</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Version path </span><span class="si">{</span><span class="n">version_path</span><span class="si">!r}</span><span class="s2"> did not match anything in API response&quot;</span>
                <span class="p">)</span>

            <span class="n">version_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">version_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to extract version using path </span><span class="si">{</span><span class="n">version_path</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracted version: </span><span class="si">{</span><span class="n">version_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract download URL using JSONPath</span>
        <span class="n">print_verbose</span><span class="p">(</span>
            <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracting download URL from path: </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url_expr</span> <span class="o">=</span> <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">download_url_path</span><span class="p">)</span>
            <span class="n">url_matches</span> <span class="o">=</span> <span class="n">url_expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">url_matches</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Download URL path </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">!r}</span><span class="s2"> did not match anything in API response&quot;</span>
                <span class="p">)</span>

            <span class="n">download_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to extract download URL using path </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

        <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Download URL: </span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">VersionInfo</span><span class="p">(</span>
            <span class="n">version</span><span class="o">=</span><span class="n">version_str</span><span class="p">,</span>
            <span class="n">download_url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">&quot;http_json&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate http_json strategy configuration.</span>

<span class="sd">        Checks for required fields and correct types without making network calls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        app_config : dict</span>
<span class="sd">            The app configuration from the recipe.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[str]</span>
<span class="sd">            List of error messages (empty if valid).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="c1"># Check required fields</span>
        <span class="k">if</span> <span class="s2">&quot;api_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.api_url&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;api_url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.api_url must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;api_url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.api_url cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;version_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.version_path&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_path&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version_path must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version_path cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate JSONPath syntax</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">jsonpath_ng</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">jsonpath_parse</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_path&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid version_path JSONPath: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;download_url_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.download_url_path&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.download_url_path must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.download_url_path cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Validate JSONPath syntax</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">jsonpath_ng</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">jsonpath_parse</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid download_url_path JSONPath: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Optional fields validation</span>
        <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.method must be a string&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">]:</span>
                <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.method must be &#39;GET&#39; or &#39;POST&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;headers&quot;</span> <span class="ow">in</span> <span class="n">source</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.headers must be a dictionary&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="n">source</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.body must be a dictionary&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_version_info</span><span class="p">(</span><span class="n">app_config</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Query JSON API for version and download URL without downloading (version-first path).</p>
<p>This method calls a JSON API, extracts version and download URL using
JSONPath expressions. If the version matches cached state, the download
can be skipped entirely.</p>
<h6 id="notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--parameters">Parameters</h6>
<p>app_config : dict
    App configuration containing source.api_url, source.version_path,
    and source.download_url_path.
verbose : bool, optional
    If True, print verbose logging messages. Default is False.
debug : bool, optional
    If True, print debug logging messages. Default is False.</p>
<h6 id="notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--returns">Returns</h6>
<p>VersionInfo
    Version info with version string, download URL, and source name.</p>
<h6 id="notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--raises">Raises</h6>
<p>ValueError
    If required config fields are missing, invalid, or if JSONPath
    expressions don't match anything in the response.
RuntimeError
    If API call fails (chained with 'from err').</p>
<h6 id="notapkgtool.discovery.http_json.HttpJsonStrategy.get_version_info--examples">Examples</h6>
<blockquote>
<blockquote>
<blockquote>
<p>strategy = HttpJsonStrategy()
config = {
...     "source": {
...         "api_url": "https://api.vendor.com/latest",
...         "version_path": "version",
...         "download_url_path": "download_url"
...     }
... }
version_info = strategy.get_version_info(config)
version_info.version
'1.0.0'</p>
</blockquote>
</blockquote>
</blockquote>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/http_json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_version_info</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VersionInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query JSON API for version and download URL without downloading (version-first path).</span>

<span class="sd">    This method calls a JSON API, extracts version and download URL using</span>
<span class="sd">    JSONPath expressions. If the version matches cached state, the download</span>
<span class="sd">    can be skipped entirely.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        App configuration containing source.api_url, source.version_path,</span>
<span class="sd">        and source.download_url_path.</span>
<span class="sd">    verbose : bool, optional</span>
<span class="sd">        If True, print verbose logging messages. Default is False.</span>
<span class="sd">    debug : bool, optional</span>
<span class="sd">        If True, print debug logging messages. Default is False.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VersionInfo</span>
<span class="sd">        Version info with version string, download URL, and source name.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If required config fields are missing, invalid, or if JSONPath</span>
<span class="sd">        expressions don&#39;t match anything in the response.</span>
<span class="sd">    RuntimeError</span>
<span class="sd">        If API call fails (chained with &#39;from err&#39;).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; strategy = HttpJsonStrategy()</span>
<span class="sd">    &gt;&gt;&gt; config = {</span>
<span class="sd">    ...     &quot;source&quot;: {</span>
<span class="sd">    ...         &quot;api_url&quot;: &quot;https://api.vendor.com/latest&quot;,</span>
<span class="sd">    ...         &quot;version_path&quot;: &quot;version&quot;,</span>
<span class="sd">    ...         &quot;download_url_path&quot;: &quot;download_url&quot;</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; version_info = strategy.get_version_info(config)</span>
<span class="sd">    &gt;&gt;&gt; version_info.version</span>
<span class="sd">    &#39;1.0.0&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">notapkgtool.cli</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_verbose</span>

    <span class="c1"># Validate configuration</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_url&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">api_url</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;http_json strategy requires &#39;source.api_url&#39; in config&quot;</span><span class="p">)</span>

    <span class="n">version_path</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;version_path&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">version_path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;http_json strategy requires &#39;source.version_path&#39; in config&quot;</span>
        <span class="p">)</span>

    <span class="n">download_url_path</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">download_url_path</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;http_json strategy requires &#39;source.download_url_path&#39; in config&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Optional configuration</span>
    <span class="n">method</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid method: </span><span class="si">{</span><span class="n">method</span><span class="si">!r}</span><span class="s2">. Must be &#39;GET&#39; or &#39;POST&#39;&quot;</span><span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">timeout</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="s2">&quot;Strategy: http_json (version-first)&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;API URL: </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Version path: </span><span class="si">{</span><span class="n">version_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Download URL path: </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Expand environment variables in headers</span>
    <span class="n">expanded_headers</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;${&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">env_var</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">env_value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">env_var</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">env_value</span><span class="p">:</span>
                <span class="n">print_verbose</span><span class="p">(</span>
                    <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Warning: Environment variable </span><span class="si">{</span><span class="n">env_var</span><span class="si">}</span><span class="s2"> not set&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expanded_headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">env_value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expanded_headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Make API request</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Calling API: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">api_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">api_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">expanded_headers</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># POST</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="n">api_url</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">expanded_headers</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;API request failed: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to call API: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;API response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> OK&quot;</span><span class="p">)</span>

    <span class="c1"># Parse JSON response</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">json_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid JSON response from API. Response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
        <span class="n">print_verbose</span><span class="p">(</span>
            <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;JSON response: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Extract version using JSONPath</span>
    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracting version from path: </span><span class="si">{</span><span class="n">version_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">version_expr</span> <span class="o">=</span> <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">version_path</span><span class="p">)</span>
        <span class="n">version_matches</span> <span class="o">=</span> <span class="n">version_expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_matches</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Version path </span><span class="si">{</span><span class="n">version_path</span><span class="si">!r}</span><span class="s2"> did not match anything in API response&quot;</span>
            <span class="p">)</span>

        <span class="n">version_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">version_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to extract version using path </span><span class="si">{</span><span class="n">version_path</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracted version: </span><span class="si">{</span><span class="n">version_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Extract download URL using JSONPath</span>
    <span class="n">print_verbose</span><span class="p">(</span>
        <span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Extracting download URL from path: </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">url_expr</span> <span class="o">=</span> <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">download_url_path</span><span class="p">)</span>
        <span class="n">url_matches</span> <span class="o">=</span> <span class="n">url_expr</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">url_matches</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Download URL path </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">!r}</span><span class="s2"> did not match anything in API response&quot;</span>
            <span class="p">)</span>

        <span class="n">download_url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">url_matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to extract download URL using path </span><span class="si">{</span><span class="n">download_url_path</span><span class="si">!r}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">err</span>

    <span class="n">print_verbose</span><span class="p">(</span><span class="s2">&quot;DISCOVERY&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Download URL: </span><span class="si">{</span><span class="n">download_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">VersionInfo</span><span class="p">(</span>
        <span class="n">version</span><span class="o">=</span><span class="n">version_str</span><span class="p">,</span>
        <span class="n">download_url</span><span class="o">=</span><span class="n">download_url</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="s2">&quot;http_json&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_config</span><span class="p">(</span><span class="n">app_config</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate http_json strategy configuration.</p>
<p>Checks for required fields and correct types without making network calls.</p>
<h6 id="notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config--parameters">Parameters</h6>
<p>app_config : dict
    The app configuration from the recipe.</p>
<h6 id="notapkgtool.discovery.http_json.HttpJsonStrategy.validate_config--returns">Returns</h6>
<p>list[str]
    List of error messages (empty if valid).</p>


            <details class="quote">
              <summary>Source code in <code>notapkgtool/discovery/http_json.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate http_json strategy configuration.</span>

<span class="sd">    Checks for required fields and correct types without making network calls.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    app_config : dict</span>
<span class="sd">        The app configuration from the recipe.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of error messages (empty if valid).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">app_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="c1"># Check required fields</span>
    <span class="k">if</span> <span class="s2">&quot;api_url&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.api_url&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;api_url&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.api_url must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;api_url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.api_url cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;version_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.version_path&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_path&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version_path must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.version_path cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Validate JSONPath syntax</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">jsonpath_ng</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">jsonpath_parse</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;version_path&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid version_path JSONPath: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;download_url_path&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Missing required field: source.download_url_path&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.download_url_path must be a string&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.download_url_path cannot be empty&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Validate JSONPath syntax</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">jsonpath_ng</span><span class="w"> </span><span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">jsonpath_parse</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">jsonpath_parse</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;download_url_path&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid download_url_path JSONPath: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Optional fields validation</span>
    <span class="k">if</span> <span class="s2">&quot;method&quot;</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.method must be a string&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">]:</span>
            <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.method must be &#39;GET&#39; or &#39;POST&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;headers&quot;</span> <span class="ow">in</span> <span class="n">source</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.headers must be a dictionary&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;body&quot;</span> <span class="ow">in</span> <span class="n">source</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;source.body must be a dictionary&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>